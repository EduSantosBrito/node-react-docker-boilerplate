version: "3"
services: 
  node-react-boilerplate-client:
    container_name: node-react-boilerplate-client
    build: 
      context: ./client
      dockerfile: Dockerfile
    restart: always
    environment: 
      NODE_ENV: production
      REACT_APP_PORT: 80
      REACT_APP_HOST: 0.0.0.0
      REACT_APP_API_HOST: 0.0.0.0
      REACT_APP_API_PORT: 3001
    ports:
      - "50100:80"
    depends_on:
      - node-react-boilerplate-server
    networks:
      - node-react-boilerplate-network
    volumes:
      - ./client:/usr/src/app
  node-react-boilerplate-server: 
    container_name: node-react-boilerplate-server
    build: 
      context: ./server
      dockerfile: Dockerfile
    restart: always
    environment:
      NODE_ENV: production
      NODE_PORT: 3001
      NODE_HOST: 0.0.0.0
      MONGODB_PORT: 27017
      MONGODB_HOST: node-react-boilerplate-mongo
      MONGODB_DATABASE: node-react-boilerplate-database
    ports: 
      - "50110:3001"
    depends_on:
      - node-react-boilerplate-mongo
    networks:
      - node-react-boilerplate-network
    volumes:
      - ./server:/usr/src/server
  node-react-boilerplate-mongo: 
    container_name: node-react-boilerplate-mongo
    image: mongo
    restart: always
    environment:
      MONGODB_PORT: 27017
      MONGODB_HOST: 0.0.0.0
    volumes:
      - ./data:/data/db
    ports: 
      - "50120:27017"
    networks:
      - node-react-boilerplate-network

networks: 
  node-react-boilerplate-network:
    driver: bridge